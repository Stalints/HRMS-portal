{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Messages | HR Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body { background-color: #f5f7fa; font-family: 'Inter', sans-serif; }

        .navbar { background-color: #1e3a8a; }
        .navbar .navbar-brand { color: #fff; font-weight: 600; }
        .navbar span { color: #cbd5e1; }

        .threads-card { height: 80vh; border-radius: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
        .thread-item {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 16px; margin: 6px 10px;
            border-radius: 12px; cursor: pointer;
            transition: 0.3s ease; background-color: #f8fafc;
        }
        .thread-item:hover { background: #e0e7ff; transform: translateX(3px); }
        .thread-active { background: #c7d2fe; border-left: 4px solid #1e3a8a; }

        .thread-avatar {
            width: 42px; height: 42px; border-radius: 50%;
            font-weight: 600; color: #fff;
            display: flex; justify-content: center; align-items: center;
        }
        .avatar-finance { background: #4f46e5; }
        .avatar-project { background: #f59e0b; }
        .avatar-hr { background: #10b981; }

        .message-card { height: 80vh; border-radius: 16px; display: flex; flex-direction: column; }
        .message-card .card-header { background-color: #1e3a8a; color: #fff; }

        .messages {
            flex: 1; padding: 20px; display: flex;
            flex-direction: column; gap: 16px;
            overflow-y: auto; background-color: #f9fafb;
        }

        .message {
            max-width: 70%; padding: 14px 18px;
            border-radius: 20px; font-size: 0.95rem;
        }
        .sent { background: #c7d2fe; align-self: flex-end; }
        .received { background: #d1fae5; align-self: flex-start; }

        .card-footer { display: flex; gap: 10px; padding: 16px; }
        textarea { flex: 1; border-radius: 16px; padding: 12px; resize: none; }
        .btn-send { background-color: #1e3a8a; color: #fff; border-radius: 16px; }
    </style>
</head>

<body>

<nav class="navbar shadow-sm">
    <div class="container d-flex justify-content-between">
        <a class="navbar-brand" href="{% url 'core:client_dashboard' %}">
            <i class="bi bi-building"></i> HR Portal
        </a>
        <span><i class="bi bi-person-circle"></i> Client</span>
    </div>
</nav>

<div class="container my-4">
    <div class="row g-4">

        <!-- Conversations -->
        <div class="col-md-4">
            <div class="card threads-card">
                <div class="card-header">Conversations</div>
                <ul class="list-group list-group-flush">

                    <!-- Finance -->
                    <li class="list-group-item thread-item thread-active"
                        data-title="Finance Team • Invoice clarification"
                        data-messages='[
                          {"type":"received","sender":"Finance Team","time":"10:15 AM","text":"Please check the updated invoice attached."},
                          {"type":"sent","sender":"You","time":"10:30 AM","text":"Thanks, I will review and confirm shortly."},
                          {"type":"received","sender":"Finance Team","time":"10:35 AM","text":"Let us know if you need any changes."}
                        ]'>
                        <div class="thread-avatar avatar-finance">F</div>
                        <div>
                            <strong>Finance Team</strong><br>
                            <small>Invoice clarification</small>
                        </div>
                    </li>

                    <!-- Project -->
                    <li class="list-group-item thread-item"
                        data-title="Project Manager • Sprint update"
                        data-messages='[
                          {"type":"received","sender":"Project Manager","time":"9:00 AM","text":"Sprint is on track."},
                          {"type":"sent","sender":"You","time":"9:10 AM","text":"Great, keep me posted."}
                        ]'>
                        <div class="thread-avatar avatar-project">P</div>
                        <div>
                            <strong>Project Manager</strong><br>
                            <small>Sprint update</small>
                        </div>
                    </li>

                    <!-- HR -->
                    <li class="list-group-item thread-item"
                        data-title="HR Team • Document submission"
                        data-messages='[
                          {"type":"received","sender":"HR Team","time":"11:00 AM","text":"Please submit your pending documents."}
                        ]'>
                        <div class="thread-avatar avatar-hr">H</div>
                        <div>
                            <strong>HR Team</strong><br>
                            <small>Document submission</small>
                        </div>
                    </li>

                </ul>
            </div>
        </div>

        <!-- Messages -->
        <div class="col-md-8">
            <div class="card message-card">
                <div class="card-header" id="chatTitle">
                    Finance Team • Invoice clarification
                </div>

                <div class="messages" id="chatMessages"></div>

                <div class="card-footer">
                    <textarea placeholder="Type your message..."></textarea>
                    <button class="btn btn-send">
                        <i class="bi bi-send-fill"></i>
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const threads = document.querySelectorAll(".thread-item");
    const chatTitle = document.getElementById("chatTitle");
    const chatMessages = document.getElementById("chatMessages");

    function loadMessages(thread) {
        chatTitle.textContent = thread.dataset.title;
        const messages = JSON.parse(thread.dataset.messages);
        chatMessages.innerHTML = "";

        messages.forEach(msg => {
            chatMessages.innerHTML += `
                <div class="message ${msg.type}">
                    <small>${msg.sender} • ${msg.time}</small><br>
                    ${msg.text}
                </div>
            `;
        });

        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    threads.forEach(thread => {
        thread.addEventListener("click", () => {
            threads.forEach(t => t.classList.remove("thread-active"));
            thread.classList.add("thread-active");
            loadMessages(thread);
        });
    });

    // Load default active conversation
    loadMessages(document.querySelector(".thread-active"));
</script>

</body>
</html>
