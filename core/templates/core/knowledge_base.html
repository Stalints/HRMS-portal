{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Knowledge Base | HR Portal</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'core/css/style.css' %}">

  <style>
    :root {
      /* dashboard/projects theme */
      --bg: #f6f7fb;
      --card: rgba(255, 255, 255, .78);
      --card-strong: rgba(255, 255, 255, .92);
      --text: #0b1220;
      --muted: #667085;
      --border: rgba(15, 23, 42, .10);

      --primary: hsl(243 75% 59%);
      --p2: hsl(262 60% 58%);
      --p3: hsl(330 65% 55%);
      --teal: hsl(172 56% 42%);
      --blue: hsl(200 70% 50%);
      --green: hsl(152 55% 42%);
      --amber: hsl(35 80% 55%);

      --shadow: 0 18px 50px rgba(2, 6, 23, .08);
      --shadow-soft: 0 10px 26px rgba(2, 6, 23, .06);

      --r: 18px;
      --r2: 22px;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(1000px 600px at 10% -10%, rgba(99, 102, 241, .12), transparent 55%),
        radial-gradient(900px 520px at 90% 0%, rgba(236, 72, 153, .10), transparent 55%),
        linear-gradient(180deg, #f7f8ff, #f5f6fb);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* FULL FEEL */
    .wrap {
      max-width: 1400px;
      margin: 0 auto;
      padding-left: 12px;
      padding-right: 12px;
    }

    @media (min-width: 576px) {
      .wrap {
        padding-left: 18px;
        padding-right: 18px;
      }
    }

    /* NAV (dashboard) */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255, 255, 255, .70);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid rgba(15, 23, 42, .08);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--text);
      font-weight: 900;
      letter-spacing: -.02em;
    }

    .brand-badge {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--primary), var(--p2));
      color: #fff;
      box-shadow: 0 14px 28px rgba(99, 102, 241, .20);
    }

    .pill {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .80);
      border: 1px solid rgba(15, 23, 42, .10);
      box-shadow: 0 10px 18px rgba(2, 6, 23, .06);
      font-weight: 800;
      color: var(--text);
      user-select: none;
      white-space: nowrap;
    }

    .pill .avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--primary), var(--p3));
      color: #fff;
    }

    /* BASE CARD */
    .card-base {
      background: var(--card-strong);
      border: 1px solid rgba(15, 23, 42, .10);
      border-radius: var(--r2);
      box-shadow: var(--shadow-soft);
    }

    /* HERO */
    .hero {
      position: relative;
      overflow: hidden;
    }

    .hero-accent {
      height: 6px;
      background: linear-gradient(90deg, var(--primary), var(--p2), var(--p3));
    }

    .hero::after {
      content: "";
      position: absolute;
      top: -90px;
      right: -90px;
      width: 260px;
      height: 260px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(99, 102, 241, .12), transparent 65%);
      pointer-events: none;
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(22px, 2vw, 30px);
      font-weight: 950;
      letter-spacing: -.03em;
      line-height: 1.15;
    }

    .hero p {
      margin: 10px 0 0;
      color: var(--muted);
      max-width: 640px;
      font-weight: 700;
      line-height: 1.35;
    }

    /* BUTTONS */
    .btn-grad {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 14px;
      text-decoration: none;
      color: #fff;
      font-weight: 900;
      background: linear-gradient(90deg, var(--primary), var(--p2));
      box-shadow: 0 16px 30px rgba(99, 102, 241, .22);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      border: 0;
      white-space: nowrap;
    }

    .btn-grad:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 22px 40px rgba(99, 102, 241, .28);
      filter: brightness(1.03);
      color: #fff;
    }

    .btn-soft {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: rgba(15, 23, 42, .04);
      border: 1px solid rgba(15, 23, 42, .10);
      color: rgba(15, 23, 42, .65);
      text-decoration: none;
      transition: transform .16s ease, border-color .16s ease, background .16s ease, color .16s ease;
    }

    .btn-soft:hover {
      transform: translateY(-1px);
      border-color: rgba(99, 102, 241, .25);
      background: rgba(99, 102, 241, .06);
      color: rgba(15, 23, 42, .90);
    }

    /* LIST HEAD */
    .list-head {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(15, 23, 42, .08);
      background: linear-gradient(180deg, rgba(255, 255, 255, .98), rgba(255, 255, 255, .86));
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      border-top-left-radius: var(--r2);
      border-top-right-radius: var(--r2);
    }

    .title {
      margin: 0;
      font-weight: 950;
      letter-spacing: -.01em;
      color: rgba(2, 6, 23, .92);
      line-height: 1.2;
    }

    .sub {
      color: var(--muted);
      font-weight: 800;
      font-size: .92rem;
    }

    /* SEARCH */
    .search {
      position: relative;
      flex: 1;
      min-width: 240px;
      max-width: 520px;
    }

    .search i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(2, 6, 23, .55);
    }

    .search input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, .12);
      padding: .62rem .95rem .62rem 2.35rem;
      background: rgba(15, 23, 42, .03);
      font-weight: 800;
      outline: none;
    }

    .search input:focus {
      box-shadow: 0 0 0 .25rem rgba(99, 102, 241, .12);
      border-color: rgba(99, 102, 241, .30);
      background: rgba(255, 255, 255, .95);
    }

    .btn-clear {
      border-radius: 14px;
      font-weight: 900;
      border: 1px solid rgba(15, 23, 42, .12);
      background: rgba(15, 23, 42, .03);
      padding: 10px 14px;
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
      white-space: nowrap;
    }

    .btn-clear:hover {
      transform: translateY(-1px);
      border-color: rgba(99, 102, 241, .25);
      background: rgba(99, 102, 241, .06);
    }

    /* CHIPS */
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 14px 16px 16px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: .55rem;
      padding: .58rem .88rem;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, .12);
      background: rgba(255, 255, 255, .86);
      box-shadow: var(--shadow-soft);
      color: rgba(2, 6, 23, .88);
      font-weight: 900;
      cursor: pointer;
      user-select: none;
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease, background .14s ease;
      white-space: nowrap;
    }

    .chip:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow);
      border-color: rgba(99, 102, 241, .22);
    }

    .chip.active {
      border-color: rgba(99, 102, 241, .35);
      background: rgba(99, 102, 241, .08);
      color: rgba(79, 70, 229, 1);
    }

    /* ARTICLE CARD */
    .a-card {
      border-radius: var(--r2);
      background: rgba(255, 255, 255, .86);
      border: 1px solid rgba(15, 23, 42, .10);
      box-shadow: var(--shadow-soft);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      position: relative;
      overflow: hidden;
      height: 100%;
      text-decoration: none;
      color: inherit;
      display: flex;
      gap: 12px;
      padding: 14px;
    }

    .a-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: rgba(99, 102, 241, .22);
      color: inherit;
    }

    .a-ic {
      width: 50px;
      height: 50px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      font-size: 1.2rem;
      border: 1px solid rgba(255, 255, 255, .62);
      box-shadow: 0 14px 28px rgba(2, 6, 23, .08);
      flex: 0 0 auto;
    }

    .a-body {
      min-width: 0;
      flex: 1;
    }

    .a-title {
      font-weight: 950;
      margin: 0 0 4px;
      letter-spacing: -.01em;
      color: rgba(2, 6, 23, .92);
      line-height: 1.2;
    }

    .a-desc {
      margin: 0;
      color: var(--muted);
      font-weight: 700;
      font-size: .95rem;
      line-height: 1.35;
    }

    .a-meta {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      color: rgba(2, 6, 23, .65);
      font-weight: 850;
      font-size: .86rem;
    }

    .badge-soft {
      border-radius: 999px;
      padding: .25rem .6rem;
      border: 1px solid rgba(15, 23, 42, .12);
      background: rgba(255, 255, 255, .78);
      color: rgba(15, 23, 42, .70);
      font-weight: 900;
    }

    /* icon theme blocks */
    .ic-billing {
      background: linear-gradient(135deg, rgba(16, 185, 129, .22), rgba(16, 185, 129, .08));
      color: rgba(5, 150, 105, 1);
    }

    .ic-payments {
      background: linear-gradient(135deg, rgba(245, 158, 11, .22), rgba(245, 158, 11, .08));
      color: rgba(217, 119, 6, 1);
    }

    .ic-support {
      background: linear-gradient(135deg, rgba(244, 63, 94, .20), rgba(244, 63, 94, .07));
      color: rgba(225, 29, 72, 1);
    }

    .ic-projects {
      background: linear-gradient(135deg, rgba(59, 130, 246, .22), rgba(59, 130, 246, .08));
      color: rgba(30, 58, 138, 1);
    }

    .ic-events {
      background: linear-gradient(135deg, rgba(34, 197, 94, .20), rgba(34, 197, 94, .07));
      color: rgba(22, 163, 74, 1);
    }

    /* SIDE CARD */
    .side-card {
      padding: 16px;
    }

    .side-title {
      font-weight: 950;
      margin: 0 0 10px;
      letter-spacing: -.01em;
    }

    .quick-link {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(15, 23, 42, .10);
      background: rgba(255, 255, 255, .86);
      text-decoration: none;
      color: inherit;
      font-weight: 900;
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
      box-shadow: var(--shadow-soft);
      margin-top: 12px;
    }

    .quick-link:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: rgba(99, 102, 241, .22);
      color: inherit;
    }

    .quick-link small {
      color: var(--muted);
      font-weight: 800;
      display: block;
      margin-top: 2px;
    }

    /* Empty */
    .empty {
      border-radius: var(--r2);
      border: 1px solid rgba(15, 23, 42, .10);
      background: rgba(255, 255, 255, .80);
      box-shadow: var(--shadow-soft);
    }

    /* FOOTER */
    .footer {
      border-top: 1px solid rgba(15, 23, 42, .08);
      margin-top: 36px;
      padding-top: 18px;
    }

    .footer-note {
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .footer-note .mini {
      width: 22px;
      height: 22px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      background: rgba(15, 23, 42, .04);
      border: 1px solid rgba(15, 23, 42, .08);
      color: rgba(15, 23, 42, .60);
    }

    .logout {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid rgba(15, 23, 42, .10);
      background: rgba(255, 255, 255, .80);
      color: rgba(15, 23, 42, .70);
      font-weight: 900;
      text-decoration: none;
      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease, color .18s ease;
    }

    .logout:hover {
      transform: translateY(-1px);
      border-color: rgba(99, 102, 241, .28);
      box-shadow: 0 12px 24px rgba(2, 6, 23, .08);
      color: rgba(15, 23, 42, .90);
    }

    @media (max-width: 768px) {
      .search {
        max-width: none;
      }
    }
  </style>
</head>

<body>

  <!-- NAV (dashboard style) -->
  <nav class="topbar">
    <div class="wrap">
      <div class="d-flex align-items-center justify-content-between" style="height:64px;">
        <a class="brand" href="{% url 'core:client_dashboard' %}">
          <span class="brand-badge"><i class="bi bi-building"></i></span>
          <span>HR Portal</span>
        </a>

        <div class="pill">
          <span class="avatar"><i class="bi bi-person-fill" style="font-size:.85rem;"></i></span>
          Client
        </div>
      </div>
    </div>
  </nav>

  <main class="wrap py-4 py-sm-5">

    <!-- HERO (projects-style) -->
    <section class="card-base hero">
      <div class="hero-accent"></div>

      <div
        class="p-4 p-sm-5 d-flex flex-column flex-sm-row align-items-start align-items-sm-center justify-content-between gap-3 gap-sm-4">
        <div class="d-flex align-items-center gap-3">
          <a class="btn-soft" href="{% url 'core:client_dashboard' %}" title="Back">
            <i class="bi bi-arrow-left"></i>
          </a>

          <div>
            <h1>Knowledge Base <span style="font-size:1.05em;">üìö</span></h1>
            <p>Find answers fast ‚Äî guides, FAQs, and step-by-step help.</p>
          </div>
        </div>

        <div class="d-flex gap-2 gap-sm-3 flex-wrap">
          <a class="btn-grad" href="{% url 'core:support' %}">
            <i class="bi bi-headset"></i> Raise Ticket
          </a>
        </div>
      </div>
    </section>

    <!-- Search + Categories -->
    <section class="mt-4">
      <div class="card-base overflow-hidden">
        <div class="list-head">
          <div>
            <div class="title">Search Articles</div>
            <div class="sub">Use search + category filter to find answers quickly</div>
          </div>

          <div class="d-flex gap-2 align-items-center flex-wrap" style="flex:1; justify-content:flex-end;">
            <div class="search">
              <i class="bi bi-search"></i>
              <input id="kbSearch" type="text" placeholder="Search articles‚Ä¶ e.g., invoice payment, profile update">
            </div>

            <button id="kbClear" class="btn-clear" type="button">
              <i class="bi bi-x-circle me-1"></i> Clear
            </button>
          </div>
        </div>

        <div class="chips">
          <span class="chip active" data-cat="all"><i class="bi bi-grid"></i> All</span>
          <span class="chip" data-cat="billing"><i class="bi bi-receipt"></i> Billing</span>
          <span class="chip" data-cat="payments"><i class="bi bi-credit-card"></i> Payments</span>
          <span class="chip" data-cat="projects"><i class="bi bi-kanban"></i> Projects</span>
          <span class="chip" data-cat="support"><i class="bi bi-headset"></i> Support</span>
        </div>
      </div>
    </section>

    <!-- Content -->
    <section class="mt-4">
      <div class="row g-3 g-lg-4">

        <!-- Main -->
        <div class="col-12 col-lg-8">
          <div class="d-flex align-items-end justify-content-between flex-wrap gap-2 mb-2">
            <div>
              <div class="title" style="font-size:1.05rem;">Popular Articles</div>
              <div class="sub">Most viewed guides to get you started</div>
            </div>
            <div class="text-muted fw-bold small">
              <i class="bi bi-lightning-charge me-1"></i> Tip: Search + Filter
            </div>
          </div>

          <div class="row g-3" id="kbList">
            <!-- 1 -->
            <div class="col-12">
              <a href="#" class="a-card kb-item" data-cat="billing"
                data-title="Download invoices and understand invoice status">
                <div class="a-ic ic-billing"><i class="bi bi-receipt"></i></div>
                <div class="a-body">
                  <div class="a-title">Download invoices & understand status</div>
                  <p class="a-desc">Where to view invoices, what ‚ÄúPending / Paid‚Äù means, and how to download PDFs.</p>
                  <div class="a-meta">
                    <span class="badge-soft">Billing</span>
                    <span><i class="bi bi-clock me-1"></i> 2 min read</span>
                    <span><i class="bi bi-eye me-1"></i> Popular</span>
                  </div>
                </div>
                <div class="ms-auto d-flex align-items-center text-muted fw-bold">
                  <i class="bi bi-chevron-right"></i>
                </div>
              </a>
            </div>

            <!-- 2 -->
            <div class="col-12">
              <a href="#" class="a-card kb-item" data-cat="payments"
                data-title="Pay an invoice and confirm payment success">
                <div class="a-ic ic-payments"><i class="bi bi-credit-card"></i></div>
                <div class="a-body">
                  <div class="a-title">Pay an invoice & confirm payment</div>
                  <p class="a-desc">Step-by-step payment flow, receipts, and what to do if payment is stuck.</p>
                  <div class="a-meta">
                    <span class="badge-soft">Payments</span>
                    <span><i class="bi bi-clock me-1"></i> 3 min read</span>
                  </div>
                </div>
                <div class="ms-auto d-flex align-items-center text-muted fw-bold">
                  <i class="bi bi-chevron-right"></i>
                </div>
              </a>
            </div>


            <!-- 4 -->
            <div class="col-12">
              <a href="#" class="a-card kb-item" data-cat="support"
                data-title="Raise a support ticket and track updates">
                <div class="a-ic ic-support"><i class="bi bi-headset"></i></div>
                <div class="a-body">
                  <div class="a-title">Raise a support ticket & track updates</div>
                  <p class="a-desc">Create tickets, attach files, and check status changes from your dashboard.</p>
                  <div class="a-meta">
                    <span class="badge-soft">Support</span>
                    <span><i class="bi bi-clock me-1"></i> 4 min read</span>
                  </div>
                </div>
                <div class="ms-auto d-flex align-items-center text-muted fw-bold">
                  <i class="bi bi-chevron-right"></i>
                </div>
              </a>
            </div>

            <!-- 5 -->
            <div class="col-12">
              <a href="#" class="a-card kb-item" data-cat="projects"
                data-title="How to follow project progress and milestones">
                <div class="a-ic ic-projects"><i class="bi bi-kanban"></i></div>
                <div class="a-body">
                  <div class="a-title">Follow project progress & milestones</div>
                  <p class="a-desc">Understand task status, milestones, and how to track ongoing work.</p>
                  <div class="a-meta">
                    <span class="badge-soft">Projects</span>
                    <span><i class="bi bi-clock me-1"></i> 3 min read</span>
                  </div>
                </div>
                <div class="ms-auto d-flex align-items-center text-muted fw-bold">
                  <i class="bi bi-chevron-right"></i>
                </div>
              </a>
            </div>
          </div>

          <div id="kbEmpty" class="empty mt-3 p-3" style="display:none;">
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-search fs-4" style="color: rgba(79,70,229,1);"></i>
              <div>
                <div class="fw-black" style="font-weight:950;">No articles found</div>
                <div class="text-muted fw-bold">Try a different keyword or switch category.</div>
              </div>
            </div>
          </div>

        </div>

        <!-- Side -->
        <div class="col-12 col-lg-4">
          <div class="card-base side-card">
            <h5 class="side-title">Quick Actions</h5>

            <a class="quick-link" href="{% url 'core:invoices' %}">
              <div>
                <div><i class="bi bi-receipt me-2"></i> Open Invoices</div>
                <small>Download / check status</small>
              </div>
              <i class="bi bi-chevron-right"></i>
            </a>

            <a class="quick-link" href="{% url 'core:payments' %}">
              <div>
                <div><i class="bi bi-credit-card me-2"></i> Payments</div>
                <small>History & confirmations</small>
              </div>
              <i class="bi bi-chevron-right"></i>
            </a>


            <a class="quick-link" href="{% url 'core:profile' %}">
              <div>
                <div><i class="bi bi-person-circle me-2"></i> Profile</div>
                <small>Update your details</small>
              </div>
              <i class="bi bi-chevron-right"></i>
            </a>

            <div class="mt-3 p-3"
              style="border-radius:18px; border:1px solid rgba(15,23,42,.10); background: rgba(255,255,255,.80); box-shadow: var(--shadow-soft);">
              <div class="fw-black" style="font-weight:950;">
                <i class="bi bi-info-circle me-1"></i> Need human help?
              </div>
              <div class="text-muted fw-bold mb-2">If an article doesn‚Äôt solve it, raise a ticket.</div>
              <a class="btn-grad w-100 justify-content-center" href="{% url 'core:support' %}">
                <i class="bi bi-headset"></i> Raise Support Ticket
              </a>
            </div>

          </div>
        </div>

      </div>
    </section>

    <!-- FOOTER (dashboard style) -->
    <footer class="footer">
      <div class="d-flex flex-column flex-sm-row align-items-center justify-content-between gap-3">
        <div class="footer-note">
          <span class="mini"><i class="bi bi-shield-check"></i></span>
          Your data is encrypted and securely stored.
        </div>
        <a class="logout" href="{% url 'logout' %}">
          <i class="bi bi-box-arrow-right"></i> Logout
        </a>
      </div>
    </footer>

  </main>

  <script>
    const searchInput = document.getElementById("kbSearch");
    const clearBtn = document.getElementById("kbClear");
    const chips = document.querySelectorAll(".chip");
    const items = document.querySelectorAll(".kb-item");
    const empty = document.getElementById("kbEmpty");

    let activeCat = "all";

    function normalize(s) { return (s || "").toLowerCase().trim(); }

    function applyFilter() {
      const q = normalize(searchInput.value);
      let shown = 0;

      items.forEach(el => {
        const cat = el.getAttribute("data-cat");
        const title = normalize(el.getAttribute("data-title"));
        const text = normalize(el.innerText);

        const catOk = (activeCat === "all") || (cat === activeCat);
        const qOk = !q || title.includes(q) || text.includes(q);

        const ok = catOk && qOk;
        el.parentElement.style.display = ok ? "" : "none";
        if (ok) shown++;
      });

      empty.style.display = (shown === 0) ? "block" : "none";
    }

    chips.forEach(ch => {
      ch.addEventListener("click", () => {
        chips.forEach(c => c.classList.remove("active"));
        ch.classList.add("active");
        activeCat = ch.getAttribute("data-cat");
        applyFilter();
      });
    });

    searchInput.addEventListener("input", applyFilter);

    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      activeCat = "all";
      chips.forEach(c => c.classList.remove("active"));
      document.querySelector('.chip[data-cat="all"]').classList.add("active");
      applyFilter();
      searchInput.focus();
    });

    applyFilter();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Notification System JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const wsProtocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            const notifySocket = new WebSocket(wsProtocol + window.location.host + '/ws/notifications/');

            function updateBadge(count) {
                const badges = document.querySelectorAll('.global-chat-badge');
                badges.forEach(b => {
                    if(count > 0) {
                        b.textContent = count;
                        b.style.display = 'inline-block';
                    } else {
                        b.style.display = 'none';
                    }
                });
            }

            function showToast(sender, preview) {
                const toast = document.createElement('div');
                toast.style.position = 'fixed';
                toast.style.bottom = '20px';
                toast.style.right = '20px';
                toast.style.background = '#4f46e5';
                toast.style.color = 'white';
                toast.style.padding = '12px 20px';
                toast.style.borderRadius = '12px';
                toast.style.boxShadow = '0 10px 25px rgba(0,0,0,0.2)';
                toast.style.zIndex = '9999';
                toast.style.transition = 'opacity 0.3s';
                toast.style.fontFamily = 'system-ui, sans-serif';
                toast.innerHTML = `<div style="font-weight:bold; margin-bottom:4px;">New Message from ${sender} <span style="font-size:16px;">üí¨</span></div><div style="font-size:0.9em; opacity:0.9;">${preview}</div>`;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
            }

            notifySocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                if (data.type === 'unread_count_init') {
                    updateBadge(data.unread_count);
                } else if (data.type === 'chat_notification') {
                    updateBadge(data.unread_count);
                    if (!window.location.pathname.includes('/chat/') && !window.location.pathname.includes('/messages/')) {
                        showToast(data.sender_name, data.message_preview);
                    }
                }
            };
        });
    </script>
</body>


</html>